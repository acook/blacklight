#!/usr/bin/env bash

#shellcheck source=./lib/_shared.bash
source "$(dirname "${BASH_SOURCE[0]}")/lib/_shared.bash"
include "bl_env"

run_or_die compile $BL_CC "$BL_MAIN_PATH" $BL_CCOPTS -Oz -o $BL_OUT_NAME

BL_BIN_PATH="$BL_BIN_PATH""_$(ts_file)"

say "moving..."
mkdir -p -v "$BL_BIN_DIR"
mv -v "$BL_OUT_NAME" "$BL_BIN_PATH"

run "strip" "$BL_STRIP" "$BL_BIN_PATH"
stat -c "%n %s %A %y" "$BL_BIN_PATH"
file -b "$BL_BIN_PATH"

# TODO: Build for multiple platforms
# TODO: Create release archive

say "excutable located at $BL_BIN_PATH"

if scriptsame; then
  ok "compilation successful!"
fi
