#!/usr/bin/env bash

source "$(dirname "$BASH_SOURCE")/lib/_shared.bash"
include "bl_env"

say "obtaining criterion test framework..."
safe_cd "$BL_EXT_PATH"
run "clone" git clone --recursive https://github.com/Snaipe/Criterion

say "building citerion test framework..."
safe_cd Criterion
run "cleanup" rm -rf build
mkdir -v -p build
safe_cd build
run_or_die "configure" cmake -D CMAKE_C_COMPILER=ecc -D CMAKE_CXX_COMPILER=ecc++ -D CMAKE_INSTALL_PREFIX:PATH="$BL_LOCAL_PATH" ..
run_or_die "compile" cmake -D CMAKE_C_COMPILER=ecc -D CMAKE_CXX_COMPILER=ecc++ -D CMAKE_INSTALL_PREFIX:PATH="$BL_LOCAL_PATH" --build .
run "install" make install

if scriptsame; then
  ok "run build/test to run tests!"
fi
